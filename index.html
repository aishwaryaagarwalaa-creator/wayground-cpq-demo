<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wayground CPQ ‚Äî Quote Configurator</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --navy:    #0f1e35;
    --navy2:   #162840;
    --teal:    #0d9488;
    --teal2:   #0f766e;
    --tealLt:  #ccfbf1;
    --white:   #ffffff;
    --off:     #f0f4f8;
    --border:  #dde3ea;
    --gray:    #64748b;
    --grayLt:  #94a3b8;
    --dark:    #0f172a;
    --green:   #10b981;
    --red:     #ef4444;
    --amber:   #f59e0b;
    --blue:    #3b82f6;
    --shadow:  0 2px 12px rgba(15,30,53,0.08), 0 1px 3px rgba(15,30,53,0.05);
    --shadowMd:0 8px 32px rgba(15,30,53,0.12), 0 2px 8px rgba(15,30,53,0.06);
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--off);
    color: var(--dark);
    min-height: 100vh;
    font-size: 14px;
    line-height: 1.5;
  }

  /* ‚îÄ‚îÄ TOP NAV ‚îÄ‚îÄ */
  .topnav {
    background: var(--navy);
    height: 52px;
    display: flex;
    align-items: center;
    padding: 0 24px;
    gap: 0;
    position: sticky;
    top: 0;
    z-index: 100;
    border-bottom: 1px solid rgba(255,255,255,0.07);
  }
  .nav-logo {
    display: flex;
    align-items: center;
    gap: 10px;
    color: white;
    font-size: 15px;
    font-weight: 600;
    letter-spacing: -0.3px;
  }
  .nav-logo-mark {
    width: 28px; height: 28px;
    background: var(--teal);
    border-radius: 7px;
    display: flex; align-items: center; justify-content: center;
    font-size: 13px; font-weight: 700; color: white;
  }
  .nav-divider { width: 1px; height: 20px; background: rgba(255,255,255,0.15); margin: 0 16px; }
  .nav-breadcrumb {
    display: flex; align-items: center; gap: 6px;
    color: rgba(255,255,255,0.5); font-size: 13px;
  }
  .nav-breadcrumb span { color: rgba(255,255,255,0.85); }
  .nav-breadcrumb .sep { color: rgba(255,255,255,0.25); }
  .nav-right { margin-left: auto; display: flex; align-items: center; gap: 12px; }
  .nav-avatar {
    width: 30px; height: 30px; border-radius: 50%;
    background: linear-gradient(135deg, var(--teal), #065f46);
    display: flex; align-items: center; justify-content: center;
    color: white; font-size: 12px; font-weight: 600;
  }
  .nav-username { color: rgba(255,255,255,0.7); font-size: 13px; }

  /* ‚îÄ‚îÄ STAGE PROGRESS ‚îÄ‚îÄ */
  .stage-bar {
    background: white;
    border-bottom: 1px solid var(--border);
    padding: 0 32px;
    display: flex;
    align-items: center;
    gap: 0;
    overflow-x: auto;
  }
  .stage {
    display: flex; align-items: center; gap: 10px;
    padding: 14px 20px 14px 0;
    cursor: pointer;
    opacity: 0.45;
    transition: opacity 0.2s;
    white-space: nowrap;
    position: relative;
  }
  .stage.active { opacity: 1; }
  .stage.done { opacity: 0.75; }
  .stage.active .stage-num { background: var(--teal); color: white; border-color: var(--teal); }
  .stage.done .stage-num { background: var(--green); color: white; border-color: var(--green); }
  .stage-num {
    width: 24px; height: 24px; border-radius: 50%;
    border: 2px solid var(--border);
    display: flex; align-items: center; justify-content: center;
    font-size: 11px; font-weight: 600; color: var(--gray);
    transition: all 0.25s;
    flex-shrink: 0;
  }
  .stage.done .stage-num::after { content: '‚úì'; }
  .stage.done .stage-num { font-size: 0; }
  .stage.done .stage-num::after { font-size: 11px; }
  .stage-label { font-size: 13px; font-weight: 500; color: var(--dark); }
  .stage-arrow {
    width: 20px; height: 20px; color: var(--border);
    display: flex; align-items: center; justify-content: center;
    font-size: 16px; margin: 0 4px; flex-shrink: 0; opacity: 1;
  }

  /* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
  .main-layout {
    display: grid;
    grid-template-columns: 1fr 340px;
    gap: 20px;
    max-width: 1280px;
    margin: 0 auto;
    padding: 20px 24px;
    align-items: start;
  }

  /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
  .card {
    background: white;
    border: 1px solid var(--border);
    border-radius: 10px;
    box-shadow: var(--shadow);
    overflow: hidden;
    margin-bottom: 16px;
    animation: fadeUp 0.35s ease both;
  }
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(10px); }
    to   { opacity: 1; transform: translateY(0); }
  }
  .card:nth-child(2) { animation-delay: 0.07s; }
  .card:nth-child(3) { animation-delay: 0.14s; }
  .card:nth-child(4) { animation-delay: 0.21s; }

  .card-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    display: flex; align-items: center; gap: 10px;
    background: #fafbfc;
  }
  .card-header-icon {
    width: 30px; height: 30px; border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-size: 14px; flex-shrink: 0;
  }
  .card-title { font-size: 14px; font-weight: 600; color: var(--dark); }
  .card-subtitle { font-size: 12px; color: var(--gray); margin-top: 1px; }
  .card-body { padding: 20px; }

  /* ‚îÄ‚îÄ ACCOUNT CHECK ‚îÄ‚îÄ */
  .account-check {
    display: flex; gap: 12px; align-items: flex-start;
    padding: 14px 16px;
    border-radius: 8px;
    border: 1px solid;
    margin-bottom: 16px;
    transition: all 0.3s;
  }
  .account-check.valid   { background: #f0fdf4; border-color: #86efac; }
  .account-check.invalid { background: #fef2f2; border-color: #fca5a5; }
  .account-check.neutral { background: #f8fafc; border-color: var(--border); }
  .check-icon { font-size: 18px; flex-shrink: 0; margin-top: 1px; }
  .check-title { font-size: 13px; font-weight: 600; }
  .check-desc  { font-size: 12px; color: var(--gray); margin-top: 2px; }

  /* ‚îÄ‚îÄ FORM ELEMENTS ‚îÄ‚îÄ */
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-bottom: 14px; }
  .form-row.three { grid-template-columns: 1fr 1fr 1fr; }
  .form-row.full { grid-template-columns: 1fr; }
  .form-group { display: flex; flex-direction: column; gap: 5px; }
  label {
    font-size: 12px; font-weight: 500; color: var(--gray);
    text-transform: uppercase; letter-spacing: 0.4px;
  }
  .required::after { content: ' *'; color: var(--red); }
  input[type="text"], input[type="number"], select, textarea {
    width: 100%; padding: 9px 12px;
    border: 1.5px solid var(--border);
    border-radius: 7px;
    font-family: 'DM Sans', sans-serif;
    font-size: 13.5px;
    color: var(--dark);
    background: white;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
    -webkit-appearance: none;
  }
  input:focus, select:focus, textarea:focus {
    border-color: var(--teal);
    box-shadow: 0 0 0 3px rgba(13,148,136,0.1);
  }
  input.error { border-color: var(--red); }
  select { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2364748b' d='M6 8L1 3h10z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; padding-right: 32px; cursor: pointer; }
  .field-hint { font-size: 11px; color: var(--grayLt); margin-top: 3px; }
  .field-error { font-size: 11px; color: var(--red); margin-top: 3px; display: none; }
  .field-error.show { display: block; }

  /* ‚îÄ‚îÄ PRODUCT TABLE ‚îÄ‚îÄ */
  .product-table { width: 100%; border-collapse: collapse; }
  .product-table thead th {
    padding: 9px 12px;
    text-align: left;
    font-size: 11px;
    font-weight: 600;
    color: var(--gray);
    text-transform: uppercase;
    letter-spacing: 0.4px;
    background: #f8fafc;
    border-bottom: 1px solid var(--border);
  }
  .product-table tbody td {
    padding: 12px;
    border-bottom: 1px solid #f1f5f9;
    vertical-align: middle;
    font-size: 13.5px;
  }
  .product-table tbody tr:last-child td { border-bottom: none; }
  .product-table tbody tr { transition: background 0.15s; }
  .product-table tbody tr:hover { background: #fafbfc; }

  .product-badge {
    display: inline-flex; align-items: center; gap: 5px;
    padding: 3px 9px; border-radius: 20px;
    font-size: 11px; font-weight: 600;
  }
  .badge-core    { background: #eff6ff; color: #1d4ed8; border: 1px solid #bfdbfe; }
  .badge-addon   { background: #f0fdfa; color: #0f766e; border: 1px solid #99f6e4; }
  .badge-locked  { background: #fef9f0; color: #92400e; border: 1px solid #fde68a; }

  .qty-control {
    display: flex; align-items: center; gap: 0;
    border: 1.5px solid var(--border); border-radius: 7px;
    overflow: hidden; width: fit-content;
  }
  .qty-btn {
    width: 30px; height: 30px;
    background: #f8fafc; border: none; cursor: pointer;
    font-size: 16px; color: var(--gray);
    display: flex; align-items: center; justify-content: center;
    transition: background 0.15s;
  }
  .qty-btn:hover { background: var(--tealLt); color: var(--teal); }
  .qty-input {
    width: 50px; text-align: center;
    border: none; border-left: 1px solid var(--border); border-right: 1px solid var(--border);
    border-radius: 0 !important;
    padding: 5px 4px !important;
    font-size: 13px !important;
    font-weight: 600;
  }
  .qty-input:focus { box-shadow: none !important; border-color: var(--border) !important; }

  .price-cell { font-family: 'DM Mono', monospace; font-size: 13px; color: var(--dark); }
  .price-total { font-weight: 600; color: var(--teal2); }

  /* ‚îÄ‚îÄ DISCOUNT ‚îÄ‚îÄ */
  .discount-row {
    display: flex; align-items: center; gap: 10px;
    padding: 10px 12px;
    background: #fffbeb;
    border: 1px solid #fde68a;
    border-radius: 8px;
    margin-top: 12px;
  }
  .discount-row label { text-transform: none; letter-spacing: 0; font-size: 13px; color: var(--dark); font-weight: 500; margin: 0; }
  .discount-input-wrap { display: flex; align-items: center; gap: 4px; }
  .discount-input-wrap input { width: 64px; text-align: center; padding: 6px 8px !important; font-size: 13px !important; }
  .discount-pct { font-size: 13px; color: var(--gray); }

  /* ‚îÄ‚îÄ APPROVAL BANNER ‚îÄ‚îÄ */
  .approval-banner {
    display: flex; align-items: center; gap: 10px;
    padding: 12px 16px;
    border-radius: 8px;
    border: 1px solid;
    font-size: 13px;
    margin-top: 12px;
    transition: all 0.3s;
  }
  .approval-banner.hidden { display: none; }
  .approval-banner.warn { background: #fffbeb; border-color: #fde68a; color: #92400e; }
  .approval-banner.ok   { background: #f0fdf4; border-color: #86efac; color: #166534; }
  .approval-banner.block{ background: #fef2f2; border-color: #fca5a5; color: #991b1b; }

  /* ‚îÄ‚îÄ TOGGLE SWITCH ‚îÄ‚îÄ */
  .toggle-row {
    display: flex; align-items: center; justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid #f1f5f9;
  }
  .toggle-row:last-child { border-bottom: none; }
  .toggle-label { font-size: 13.5px; color: var(--dark); }
  .toggle-sub   { font-size: 12px; color: var(--grayLt); margin-top: 2px; }
  .toggle {
    position: relative; width: 42px; height: 22px; flex-shrink: 0;
  }
  .toggle input { opacity: 0; width: 0; height: 0; }
  .slider {
    position: absolute; cursor: pointer;
    top: 0; left: 0; right: 0; bottom: 0;
    background: var(--border); border-radius: 22px;
    transition: 0.25s;
  }
  .slider::before {
    content: ''; position: absolute;
    height: 16px; width: 16px;
    left: 3px; bottom: 3px;
    background: white; border-radius: 50%;
    transition: 0.25s;
    box-shadow: 0 1px 3px rgba(0,0,0,0.15);
  }
  input:checked + .slider { background: var(--teal); }
  input:checked + .slider::before { transform: translateX(20px); }

  /* ‚îÄ‚îÄ SUMMARY PANEL ‚îÄ‚îÄ */
  .summary-panel { position: sticky; top: 72px; }
  .summary-header {
    padding: 16px 20px;
    background: var(--navy);
    color: white;
    border-radius: 10px 10px 0 0;
  }
  .summary-title { font-size: 14px; font-weight: 600; }
  .summary-subtitle { font-size: 12px; color: rgba(255,255,255,0.55); margin-top: 2px; }
  .summary-body { padding: 16px 20px; }
  .summary-line {
    display: flex; justify-content: space-between; align-items: center;
    padding: 8px 0; border-bottom: 1px solid #f1f5f9;
    font-size: 13px;
  }
  .summary-line:last-of-type { border-bottom: none; }
  .summary-line .lbl { color: var(--gray); }
  .summary-line .val { font-weight: 500; font-family: 'DM Mono', monospace; font-size: 13px; }
  .summary-total {
    display: flex; justify-content: space-between; align-items: center;
    padding: 14px 20px;
    background: var(--navy);
    color: white;
    border-top: 1px solid rgba(255,255,255,0.08);
  }
  .summary-total .lbl { font-size: 13px; color: rgba(255,255,255,0.7); }
  .summary-total .val { font-size: 20px; font-weight: 700; font-family: 'DM Mono', monospace; color: var(--tealLt); }
  .summary-footer { padding: 16px 20px; border-top: 1px solid var(--border); }

  /* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
  .btn {
    padding: 10px 20px; border-radius: 8px;
    font-family: 'DM Sans', sans-serif;
    font-size: 13.5px; font-weight: 600;
    cursor: pointer; border: none;
    transition: all 0.18s; display: inline-flex; align-items: center; gap: 7px;
    text-decoration: none;
  }
  .btn-primary { background: var(--teal); color: white; }
  .btn-primary:hover { background: var(--teal2); transform: translateY(-1px); box-shadow: 0 4px 12px rgba(13,148,136,0.3); }
  .btn-primary:active { transform: translateY(0); }
  .btn-secondary { background: white; color: var(--dark); border: 1.5px solid var(--border); }
  .btn-secondary:hover { background: #f8fafc; border-color: var(--grayLt); }
  .btn-danger { background: #fef2f2; color: var(--red); border: 1.5px solid #fca5a5; }
  .btn-danger:hover { background: #fee2e2; }
  .btn-full { width: 100%; justify-content: center; }
  .btn-sm { padding: 7px 14px; font-size: 12.5px; }
  .btn:disabled { opacity: 0.45; cursor: not-allowed; transform: none !important; box-shadow: none !important; }

  /* ‚îÄ‚îÄ RULE VIOLATIONS ‚îÄ‚îÄ */
  .rule-box {
    background: #fef2f2; border: 1px solid #fca5a5; border-radius: 8px;
    padding: 12px 14px; margin-top: 12px;
    font-size: 12.5px; color: #991b1b;
    display: none;
  }
  .rule-box.show { display: block; }
  .rule-box ul { padding-left: 16px; margin-top: 6px; }
  .rule-box li { margin-bottom: 3px; }

  /* ‚îÄ‚îÄ OPP TYPE TAG ‚îÄ‚îÄ */
  .opp-tag {
    display: inline-flex; align-items: center; gap: 5px;
    padding: 4px 10px; border-radius: 20px;
    font-size: 12px; font-weight: 600;
    background: var(--tealLt); color: var(--teal2);
    border: 1px solid #99f6e4;
    margin-left: 8px;
  }

  /* ‚îÄ‚îÄ QUOTE OUTPUT ‚îÄ‚îÄ */
  #quote-output {
    display: none;
    animation: fadeUp 0.4s ease;
  }
  #quote-output.show { display: block; }
  .quote-doc {
    border: 2px solid var(--teal);
    border-radius: 12px;
    overflow: hidden;
  }
  .quote-doc-header {
    background: var(--navy);
    padding: 20px 24px;
    display: flex; justify-content: space-between; align-items: flex-start;
  }
  .quote-doc-title { font-size: 18px; font-weight: 700; color: white; }
  .quote-doc-meta  { font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 4px; }
  .quote-num { font-family: 'DM Mono', monospace; font-size: 13px; color: var(--tealLt); }
  .quote-doc-body { padding: 24px; }
  .quote-section-title {
    font-size: 11px; font-weight: 600; color: var(--gray);
    text-transform: uppercase; letter-spacing: 0.5px;
    margin-bottom: 10px; padding-bottom: 6px;
    border-bottom: 1px solid var(--border);
  }
  .quote-info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
  .qi-item .qi-label { font-size: 11px; color: var(--grayLt); text-transform: uppercase; letter-spacing: 0.3px; }
  .qi-item .qi-val   { font-size: 13.5px; font-weight: 500; color: var(--dark); margin-top: 2px; }

  /* ‚îÄ‚îÄ TOOLTIP ‚îÄ‚îÄ */
  .tooltip-wrap { position: relative; display: inline-flex; }
  .tooltip-icon {
    width: 16px; height: 16px; border-radius: 50%;
    background: var(--border); color: var(--gray);
    font-size: 10px; font-weight: 700;
    display: inline-flex; align-items: center; justify-content: center;
    cursor: help; margin-left: 5px;
  }
  .tooltip-box {
    position: absolute; bottom: calc(100% + 6px); left: 50%;
    transform: translateX(-50%);
    background: var(--navy); color: white;
    padding: 7px 11px; border-radius: 6px;
    font-size: 11.5px; white-space: nowrap; z-index: 10;
    pointer-events: none; opacity: 0; transition: opacity 0.2s;
    max-width: 220px; white-space: normal; text-align: center;
  }
  .tooltip-wrap:hover .tooltip-box { opacity: 1; }

  /* ‚îÄ‚îÄ STATUS CHIPS ‚îÄ‚îÄ */
  .status-chip {
    display: inline-flex; align-items: center; gap: 5px;
    padding: 3px 10px; border-radius: 20px; font-size: 11.5px; font-weight: 600;
  }
  .chip-draft    { background: #f1f5f9; color: var(--gray); }
  .chip-pending  { background: #fffbeb; color: #92400e; }
  .chip-approved { background: #f0fdf4; color: #166534; }
  .chip-dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; }

  /* ‚îÄ‚îÄ SECTION TABS ‚îÄ‚îÄ */
  .tab-row { display: flex; gap: 0; border-bottom: 2px solid var(--border); margin-bottom: 20px; }
  .tab {
    padding: 10px 18px; font-size: 13px; font-weight: 500;
    color: var(--gray); cursor: pointer; border-bottom: 2px solid transparent;
    margin-bottom: -2px; transition: all 0.2s;
  }
  .tab:hover { color: var(--dark); }
  .tab.active { color: var(--teal); border-bottom-color: var(--teal); font-weight: 600; }

  /* ‚îÄ‚îÄ STEP INDICATOR ‚îÄ‚îÄ */
  .step-note {
    font-size: 12px; color: var(--grayLt); font-style: italic;
    text-align: center; padding: 8px;
  }

  /* ‚îÄ‚îÄ ARR ATTRIBUTION ‚îÄ‚îÄ */
  .arr-bar {
    height: 8px; border-radius: 4px; background: var(--border);
    overflow: hidden; margin-top: 6px;
  }
  .arr-fill {
    height: 100%; border-radius: 4px;
    background: linear-gradient(90deg, var(--teal), #065f46);
    transition: width 0.5s ease;
  }
  .arr-row {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 10px;
  }
  .arr-label { font-size: 12.5px; color: var(--dark); }
  .arr-val { font-size: 12.5px; font-weight: 600; font-family: 'DM Mono', monospace; color: var(--teal2); }

  /* divider */
  .divider { height: 1px; background: var(--border); margin: 16px 0; }

  /* ‚îÄ‚îÄ CONFETTI / SUCCESS ‚îÄ‚îÄ */
  .success-overlay {
    display: none; position: fixed;
    inset: 0; z-index: 999;
    background: rgba(15,30,53,0.55);
    align-items: center; justify-content: center;
    animation: fadeIn 0.25s ease;
  }
  .success-overlay.show { display: flex; }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  .success-card {
    background: white; border-radius: 16px;
    padding: 40px 48px; text-align: center;
    max-width: 440px; width: 90%;
    box-shadow: var(--shadowMd);
    animation: popIn 0.35s cubic-bezier(0.34,1.56,0.64,1);
  }
  @keyframes popIn {
    from { opacity: 0; transform: scale(0.85); }
    to   { opacity: 1; transform: scale(1); }
  }
  .success-icon { font-size: 52px; margin-bottom: 16px; }
  .success-title { font-size: 22px; font-weight: 700; color: var(--dark); margin-bottom: 8px; }
  .success-sub   { font-size: 14px; color: var(--gray); line-height: 1.6; }
  .success-quote-num { font-family: 'DM Mono', monospace; font-size: 13px; color: var(--teal); background: var(--tealLt); padding: 4px 12px; border-radius: 20px; display: inline-block; margin: 12px 0; }

  /* responsive */
  @media (max-width: 900px) {
    .main-layout { grid-template-columns: 1fr; }
    .summary-panel { position: static; }
    .form-row.three { grid-template-columns: 1fr 1fr; }
  }
  @media (max-width: 600px) {
    .form-row, .form-row.three { grid-template-columns: 1fr; }
    .stage-label { display: none; }
    .main-layout { padding: 12px; }
  }

  .watermark {
    text-align: center; padding: 20px;
    font-size: 11.5px; color: var(--grayLt);
    border-top: 1px solid var(--border);
  }
  .watermark strong { color: var(--teal); }
</style>
</head>
<body>

<!-- TOP NAV -->
<nav class="topnav">
  <div class="nav-logo">
    <div class="nav-logo-mark">W</div>
    Wayground
  </div>
  <div class="nav-divider"></div>
  <div class="nav-breadcrumb">
    Opportunities <span class="sep">‚Ä∫</span>
    <span>Riverside USD ‚Äî Q2 Renewal</span> <span class="sep">‚Ä∫</span>
    <span>New Quote</span>
  </div>
  <div class="nav-right">
    <div class="nav-username">Aishwarya A.</div>
    <div class="nav-avatar">AA</div>
  </div>
</nav>

<!-- STAGE PROGRESS -->
<div class="stage-bar">
  <div class="stage done" data-step="1">
    <div class="stage-num">1</div>
    <div class="stage-label">Account Lookup</div>
  </div>
  <div class="stage-arrow">‚Ä∫</div>
  <div class="stage active" data-step="2">
    <div class="stage-num">2</div>
    <div class="stage-label">Configure Products</div>
  </div>
  <div class="stage-arrow">‚Ä∫</div>
  <div class="stage" data-step="3">
    <div class="stage-num">3</div>
    <div class="stage-label">Pricing & Discounts</div>
  </div>
  <div class="stage-arrow">‚Ä∫</div>
  <div class="stage" data-step="4">
    <div class="stage-num">4</div>
    <div class="stage-label">Approval & Review</div>
  </div>
  <div class="stage-arrow">‚Ä∫</div>
  <div class="stage" data-step="5">
    <div class="stage-num">5</div>
    <div class="stage-label">Generate Quote</div>
  </div>
</div>

<!-- MAIN LAYOUT -->
<div class="main-layout">

  <!-- LEFT COLUMN -->
  <div class="left-col">

    <!-- CARD 1: Account Info -->
    <div class="card">
      <div class="card-header">
        <div class="card-header-icon" style="background:#eff6ff;">üè´</div>
        <div>
          <div class="card-title">Account & Opportunity Details</div>
          <div class="card-subtitle">Opportunity type auto-sets based on product selection</div>
        </div>
        <div style="margin-left:auto;">
          <span class="status-chip chip-draft"><span class="chip-dot"></span>Draft</span>
        </div>
      </div>
      <div class="card-body">

        <!-- Account dependency check -->
        <div class="account-check valid" id="core-check">
          <div class="check-icon">‚úÖ</div>
          <div>
            <div class="check-title">Active Wayground Core Subscription Found</div>
            <div class="check-desc">Riverside USD ‚Ä¢ Core Plan (District) ‚Ä¢ Renews Jun 30, 2025 ‚Ä¢ 1,240 seats active</div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="required">Account Name</label>
            <input type="text" value="Riverside Unified School District" id="account-name">
          </div>
          <div class="form-group">
            <label class="required">Opportunity Name</label>
            <input type="text" value="Riverside USD ‚Äî Q2 FY25 Renewal + CA" id="opp-name">
          </div>
        </div>

        <div class="form-row three">
          <div class="form-group">
            <label>Opportunity Type</label>
            <div style="display:flex;align-items:center;gap:8px;margin-top:4px;">
              <input type="text" id="opp-type-field" value="Renewal + CA Add-On" readonly style="background:#f8fafc;color:var(--teal2);font-weight:600;cursor:default;">
            </div>
            <div class="field-hint">Auto-set by system based on product config</div>
          </div>
          <div class="form-group">
            <label class="required">Close Date</label>
            <input type="text" value="2025-06-30" id="close-date">
          </div>
          <div class="form-group">
            <label>Stage</label>
            <select id="opp-stage">
              <option>Prospecting</option>
              <option>Discovery</option>
              <option>Proposal</option>
              <option selected>Negotiation</option>
              <option>Commit</option>
              <option>Closed Won</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Primary Contact</label>
            <input type="text" value="Dr. Patricia Chen, Dir. of Curriculum">
          </div>
          <div class="form-group">
            <label>Contract Term</label>
            <select id="contract-term">
              <option value="12">12 Months (Annual)</option>
              <option value="24">24 Months (2-Year)</option>
              <option value="36">36 Months (3-Year)</option>
            </select>
          </div>
        </div>

      </div>
    </div>

    <!-- CARD 2: Product Configuration -->
    <div class="card">
      <div class="card-header">
        <div class="card-header-icon" style="background:#f0fdfa;">üì¶</div>
        <div>
          <div class="card-title">Product Configuration</div>
          <div class="card-subtitle">Select products from catalog ‚Äî CA dependency enforced automatically</div>
        </div>
      </div>
      <div class="card-body">

        <div class="tab-row">
          <div class="tab active" onclick="switchTab(this,'products')">Products</div>
          <div class="tab" onclick="switchTab(this,'options')">Options & Add-Ons</div>
          <div class="tab" onclick="switchTab(this,'notes')">Notes</div>
        </div>

        <div id="tab-products">
          <table class="product-table">
            <thead>
              <tr>
                <th style="width:36px;"><input type="checkbox" checked style="width:14px;height:14px;accent-color:var(--teal);cursor:pointer;"></th>
                <th>Product</th>
                <th>Type</th>
                <th>Unit Price</th>
                <th style="width:130px;">Qty (Seats)</th>
                <th>List Price</th>
                <th style="width:32px;"></th>
              </tr>
            </thead>
            <tbody id="product-rows">

              <!-- Core Row -->
              <tr id="row-core">
                <td><input type="checkbox" checked disabled style="width:14px;height:14px;accent-color:var(--teal);cursor:not-allowed;opacity:0.5;" title="Core required for CA"></td>
                <td>
                  <div style="font-weight:600;color:var(--dark);">Wayground Core</div>
                  <div style="font-size:11.5px;color:var(--grayLt);margin-top:2px;">District License ¬∑ Renewal</div>
                </td>
                <td><span class="product-badge badge-core">Core</span></td>
                <td class="price-cell">$18.00 /seat</td>
                <td>
                  <div class="qty-control">
                    <button class="qty-btn" onclick="changeQty('core',-100)">‚àí</button>
                    <input type="number" class="qty-input" id="qty-core" value="1240" min="100" onchange="recalc()">
                    <button class="qty-btn" onclick="changeQty('core',100)">+</button>
                  </div>
                </td>
                <td class="price-cell price-total" id="price-core">$22,320.00</td>
                <td>
                  <div class="tooltip-wrap">
                    <div class="tooltip-icon">i</div>
                    <div class="tooltip-box">Core is required for all CA purchases. Cannot be deselected when CA is active.</div>
                  </div>
                </td>
              </tr>

              <!-- CA Row -->
              <tr id="row-ca">
                <td><input type="checkbox" id="chk-ca" checked onchange="toggleCA()" style="width:14px;height:14px;accent-color:var(--teal);cursor:pointer;"></td>
                <td>
                  <div style="font-weight:600;color:var(--dark);">Common Assessment (CA)</div>
                  <div style="font-size:11.5px;color:var(--grayLt);margin-top:2px;">Add-On ¬∑ Requires active Core</div>
                </td>
                <td>
                  <span class="product-badge badge-addon">Add-On</span>
                  <div class="tooltip-wrap" style="display:inline-flex;">
                    <div class="tooltip-icon">üîí</div>
                    <div class="tooltip-box">CA can only be sold to accounts with an active Core subscription. Validation enforced by Salesforce.</div>
                  </div>
                </td>
                <td class="price-cell">$6.00 /seat</td>
                <td>
                  <div class="qty-control">
                    <button class="qty-btn" onclick="changeQty('ca',-100)">‚àí</button>
                    <input type="number" class="qty-input" id="qty-ca" value="1240" min="0" onchange="recalc()">
                    <button class="qty-btn" onclick="changeQty('ca',100)">+</button>
                  </div>
                </td>
                <td class="price-cell price-total" id="price-ca">$7,440.00</td>
                <td>
                  <div class="tooltip-wrap">
                    <div class="tooltip-icon">i</div>
                    <div class="tooltip-box">CA seats default to match Core seats. Adjustable independently.</div>
                  </div>
                </td>
              </tr>

            </tbody>
          </table>

          <!-- Validation rule violation -->
          <div class="rule-box" id="rule-violation">
            <strong>‚ö† Validation Rule: CA Dependency Not Met</strong>
            <ul>
              <li>Common Assessment cannot be added without an active Wayground Core subscription on this account.</li>
              <li>Current account status: <strong id="rule-status">No active Core found</strong></li>
              <li>To proceed, add Core to this quote or verify the account's active subscription.</li>
            </ul>
          </div>

          <!-- Discount row -->
          <div class="discount-row" id="discount-section">
            <span>üí∏</span>
            <label>Apply Discount</label>
            <div class="discount-input-wrap">
              <input type="number" id="discount-pct" value="0" min="0" max="40" step="1" onchange="recalc()" style="width:64px;text-align:center;">
              <span class="discount-pct">%</span>
            </div>
            <div style="font-size:12px;color:var(--gray);margin-left:4px;" id="discount-desc">No discount applied</div>
            <div style="margin-left:auto;">
              <div class="tooltip-wrap">
                <div class="tooltip-icon">i</div>
                <div class="tooltip-box">0‚Äì10%: Auto-approved. 11‚Äì20%: Manager approval required. 21%+: VP approval required.</div>
              </div>
            </div>
          </div>

          <!-- Approval banner -->
          <div class="approval-banner hidden" id="approval-banner">
            <span id="approval-icon">‚ö†Ô∏è</span>
            <div>
              <strong id="approval-title">Approval Required</strong>
              <div id="approval-desc" style="font-size:12px;margin-top:2px;"></div>
            </div>
          </div>

        </div>

        <!-- Tab: Options -->
        <div id="tab-options" style="display:none;">
          <div class="toggle-row">
            <div>
              <div class="toggle-label">Multi-year pricing lock</div>
              <div class="toggle-sub">Lock current price for the full contract term</div>
            </div>
            <label class="toggle"><input type="checkbox" id="toggle-multiyear" onchange="recalc()"><span class="slider"></span></label>
          </div>
          <div class="toggle-row">
            <div>
              <div class="toggle-label">Implementation & Onboarding (CA)</div>
              <div class="toggle-sub">Includes 3 training sessions + dedicated CSM onboarding</div>
            </div>
            <label class="toggle"><input type="checkbox" id="toggle-onboarding" onchange="recalc()"><span class="slider"></span></label>
          </div>
          <div class="toggle-row">
            <div>
              <div class="toggle-label">Professional Development Package</div>
              <div class="toggle-sub">5 PD sessions for teachers ‚Äî $2,500 flat fee</div>
            </div>
            <label class="toggle"><input type="checkbox" id="toggle-pd" onchange="recalc()"><span class="slider"></span></label>
          </div>
          <div class="toggle-row">
            <div>
              <div class="toggle-label">Auto-renew CA with Core renewal</div>
              <div class="toggle-sub">CA renewal will be included in future Core renewal quotes</div>
            </div>
            <label class="toggle"><input type="checkbox" id="toggle-autorenew" checked onchange="recalc()"><span class="slider"></span></label>
          </div>
          <div class="toggle-row">
            <div>
              <div class="toggle-label">Send quote for e-signature (DocuSign)</div>
              <div class="toggle-sub">Auto-route to primary contact after approval</div>
            </div>
            <label class="toggle"><input type="checkbox" id="toggle-esign" checked><span class="slider"></span></label>
          </div>
        </div>

        <!-- Tab: Notes -->
        <div id="tab-notes" style="display:none;">
          <div class="form-group">
            <label>Internal Notes (not visible on quote)</label>
            <textarea rows="3" style="resize:vertical;" placeholder="e.g. District is comparing us with Nearpod ‚Äî emphasize CA's standards alignment feature...">District requested CA be co-termed with Core renewal. Price hold through end of Q2.</textarea>
          </div>
          <div class="form-group" style="margin-top:14px;">
            <label>Quote Memo (visible to customer)</label>
            <textarea rows="3" style="resize:vertical;" placeholder="Message to include on the quote document...">Thank you for renewing with Wayground. We're excited to include Common Assessment as part of your district's toolkit this year.</textarea>
          </div>
        </div>

      </div>
    </div>

    <!-- CARD 3: ARR Attribution -->
    <div class="card">
      <div class="card-header">
        <div class="card-header-icon" style="background:#f0fdf4;">üìä</div>
        <div>
          <div class="card-title">ARR Attribution</div>
          <div class="card-subtitle">How this deal contributes to revenue ‚Äî broken down by product line</div>
        </div>
      </div>
      <div class="card-body">
        <div class="arr-row">
          <div class="arr-label">Wayground Core ARR</div>
          <div class="arr-val" id="attr-core">$22,320</div>
        </div>
        <div class="arr-bar"><div class="arr-fill" id="bar-core" style="width:75%;background:linear-gradient(90deg,#1d4ed8,#3b82f6);"></div></div>

        <div style="height:12px;"></div>

        <div class="arr-row">
          <div class="arr-label">Common Assessment ARR <span style="font-size:11px;color:var(--grayLt);">(CA Add-On)</span></div>
          <div class="arr-val" id="attr-ca">$7,440</div>
        </div>
        <div class="arr-bar"><div class="arr-fill" id="bar-ca" style="width:25%;"></div></div>

        <div class="divider"></div>

        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;text-align:center;">
          <div>
            <div style="font-size:11px;color:var(--grayLt);text-transform:uppercase;letter-spacing:0.3px;">CA Attach %</div>
            <div style="font-size:20px;font-weight:700;color:var(--teal);font-family:'DM Mono',monospace;margin-top:4px;" id="attach-pct">25%</div>
          </div>
          <div>
            <div style="font-size:11px;color:var(--grayLt);text-transform:uppercase;letter-spacing:0.3px;">Opp Type</div>
            <div style="font-size:13px;font-weight:600;color:var(--dark);margin-top:6px;" id="attr-opp-type">Renewal + CA</div>
          </div>
          <div>
            <div style="font-size:11px;color:var(--grayLt);text-transform:uppercase;letter-spacing:0.3px;">Motion</div>
            <div style="font-size:13px;font-weight:600;color:var(--dark);margin-top:6px;">Expansion</div>
          </div>
        </div>
      </div>
    </div>

    <!-- QUOTE OUTPUT -->
    <div id="quote-output">
      <div class="quote-doc">
        <div class="quote-doc-header">
          <div>
            <div class="quote-doc-title">Quote Document</div>
            <div class="quote-doc-meta">Generated by Wayground CPQ ¬∑ Auto-routed for approval</div>
          </div>
          <div style="text-align:right;">
            <div class="quote-num" id="quote-num">Q-2025-0847</div>
            <div style="font-size:12px;color:rgba(255,255,255,0.4);margin-top:4px;" id="quote-date">Generated: ‚Äî</div>
          </div>
        </div>
        <div class="quote-doc-body">
          <div class="quote-section-title">Bill To</div>
          <div class="quote-info-grid">
            <div class="qi-item"><div class="qi-label">Account</div><div class="qi-val" id="qo-account">‚Äî</div></div>
            <div class="qi-item"><div class="qi-label">Contact</div><div class="qi-val">Dr. Patricia Chen</div></div>
            <div class="qi-item"><div class="qi-label">Quote Valid Until</div><div class="qi-val" id="qo-valid">‚Äî</div></div>
            <div class="qi-item"><div class="qi-label">Contract Term</div><div class="qi-val" id="qo-term">‚Äî</div></div>
          </div>
          <div class="quote-section-title">Line Items</div>
          <table class="product-table" style="margin-bottom:16px;">
            <thead>
              <tr>
                <th>#</th><th>Product</th><th>Qty</th><th>Unit Price</th><th>Discount</th><th>Total ARR</th>
              </tr>
            </thead>
            <tbody id="quote-line-items"></tbody>
          </table>
          <div style="display:flex;justify-content:flex-end;">
            <div style="width:280px;">
              <div class="summary-line"><span class="lbl">Subtotal</span><span class="val" id="qo-subtotal">‚Äî</span></div>
              <div class="summary-line" id="qo-discount-row" style="display:none;"><span class="lbl" style="color:var(--green);">Discount Applied</span><span class="val" style="color:var(--green);" id="qo-discount-amt">‚Äî</span></div>
              <div class="summary-line" style="font-weight:700;"><span class="lbl" style="color:var(--dark);font-weight:600;">Total ARR</span><span class="val" style="font-size:15px;color:var(--teal2);" id="qo-total">‚Äî</span></div>
            </div>
          </div>
          <div class="divider"></div>
          <div style="display:flex;gap:12px;justify-content:flex-end;">
            <button class="btn btn-secondary btn-sm" onclick="closeQuote()">‚úï Close</button>
            <button class="btn btn-primary btn-sm" onclick="submitQuote()">üì§ Submit & Route for Approval</button>
          </div>
        </div>
      </div>
    </div>

  </div><!-- /left -->

  <!-- RIGHT COLUMN: SUMMARY PANEL -->
  <div class="summary-panel">

    <div class="card" style="border-radius:10px;overflow:hidden;margin-bottom:0;">
      <div class="summary-header">
        <div class="summary-title">Quote Summary</div>
        <div class="summary-subtitle" id="summary-opp">Riverside USD ‚Äî Q2 Renewal</div>
      </div>
      <div class="summary-body">
        <div class="summary-line">
          <span class="lbl">Wayground Core</span>
          <span class="val" id="sum-core">$22,320</span>
        </div>
        <div class="summary-line" id="sum-ca-row">
          <span class="lbl">Common Assessment</span>
          <span class="val" id="sum-ca">$7,440</span>
        </div>
        <div class="summary-line" id="sum-onboard-row" style="display:none;">
          <span class="lbl">Onboarding Package</span>
          <span class="val">$1,800</span>
        </div>
        <div class="summary-line" id="sum-pd-row" style="display:none;">
          <span class="lbl">PD Package</span>
          <span class="val">$2,500</span>
        </div>
        <div class="summary-line">
          <span class="lbl">Subtotal</span>
          <span class="val" id="sum-subtotal">$29,760</span>
        </div>
        <div class="summary-line" id="sum-disc-row" style="display:none;">
          <span class="lbl" style="color:var(--green);">Discount</span>
          <span class="val" style="color:var(--green);" id="sum-discount">‚Äî$0</span>
        </div>
      </div>
      <div class="summary-total">
        <span class="lbl">Total ARR / Year</span>
        <span class="val" id="sum-total">$29,760</span>
      </div>
      <div class="summary-footer">

        <div style="margin-bottom:14px;">
          <div style="font-size:11px;color:var(--grayLt);text-transform:uppercase;letter-spacing:0.3px;margin-bottom:8px;">Approval Status</div>
          <div class="status-chip chip-approved" id="approval-status-chip" style="font-size:12px;"><span class="chip-dot"></span><span id="approval-status-text">Auto-Approved (0% discount)</span></div>
        </div>

        <div style="margin-bottom:14px;">
          <div style="font-size:11px;color:var(--grayLt);text-transform:uppercase;letter-spacing:0.3px;margin-bottom:8px;">Products</div>
          <div style="display:flex;gap:6px;flex-wrap:wrap;" id="product-chips">
            <span class="product-badge badge-core">Core ‚úì</span>
            <span class="product-badge badge-addon" id="chip-ca">CA ‚úì</span>
          </div>
        </div>

        <button class="btn btn-primary btn-full" onclick="generateQuote()" id="gen-btn">
          üìÑ Generate Quote
        </button>
        <button class="btn btn-secondary btn-full" style="margin-top:8px;" onclick="saveDraft()">
          üíæ Save Draft
        </button>
      </div>
    </div>

    <!-- Mini ARR breakdown -->
    <div class="card" style="margin-top:16px;">
      <div class="card-header" style="padding:12px 16px;">
        <div style="font-size:12.5px;font-weight:600;color:var(--dark);">Pipeline Attribution</div>
      </div>
      <div class="card-body" style="padding:14px 16px;">
        <div style="font-size:11px;color:var(--grayLt);margin-bottom:8px;">This deal will be reported under:</div>
        <div style="display:flex;flex-direction:column;gap:6px;">
          <div style="display:flex;justify-content:space-between;font-size:12.5px;">
            <span style="color:var(--gray);">Motion</span>
            <span style="font-weight:600;" id="pipeline-motion">Renewal + Expansion</span>
          </div>
          <div style="display:flex;justify-content:space-between;font-size:12.5px;">
            <span style="color:var(--gray);">Opp Type Tag</span>
            <span style="font-weight:600;color:var(--teal);" id="pipeline-tag">Renewal + CA Add-On</span>
          </div>
          <div style="display:flex;justify-content:space-between;font-size:12.5px;">
            <span style="color:var(--gray);">Forecast Category</span>
            <span style="font-weight:600;" id="pipeline-forecast">Commit</span>
          </div>
          <div style="display:flex;justify-content:space-between;font-size:12.5px;">
            <span style="color:var(--gray);">Price Book</span>
            <span style="font-weight:600;">CA Add-On PB</span>
          </div>
        </div>
      </div>
    </div>

    <div class="step-note">üîí Validation rules active ¬∑ All fields auto-saved</div>
  </div><!-- /right -->

</div><!-- /main-layout -->

<div class="watermark">
  Built by <strong>Aishwarya Agarwal</strong> ¬∑ Wayground RevOps Manager Assignment ¬∑ Interactive CPQ Prototype
</div>

<!-- SUCCESS OVERLAY -->
<div class="success-overlay" id="success-overlay">
  <div class="success-card">
    <div class="success-icon">üéâ</div>
    <div class="success-title">Quote Submitted!</div>
    <div class="success-quote-num" id="success-quote-num">Q-2025-0847</div>
    <div class="success-sub">Your quote has been generated and routed for approval. The primary contact will receive an e-signature request once approved.</div>
    <div style="margin-top:24px;display:flex;gap:10px;justify-content:center;">
      <button class="btn btn-secondary" onclick="closeSuccess()">Back to Quote</button>
      <button class="btn btn-primary" onclick="closeSuccess()">View Opportunity</button>
    </div>
  </div>
</div>

<script>
const CORE_UNIT = 18;
const CA_UNIT   = 6;
const ONBOARD   = 1800;
const PD        = 2500;

function fmt(n) {
  return '$' + n.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

function changeQty(product, delta) {
  const el = document.getElementById('qty-' + product);
  const val = Math.max(0, (parseInt(el.value) || 0) + delta);
  el.value = val;
  recalc();
}

function toggleCA() {
  const checked = document.getElementById('chk-ca').checked;
  document.getElementById('qty-ca').disabled = !checked;
  document.getElementById('row-ca').style.opacity = checked ? '1' : '0.4';
  recalc();
  updateDependencyCheck(checked);
}

function updateDependencyCheck(caActive) {
  const coreQty = parseInt(document.getElementById('qty-core').value) || 0;
  const violation = document.getElementById('rule-violation');
  if (caActive && coreQty === 0) {
    violation.classList.add('show');
  } else {
    violation.classList.remove('show');
  }
}

function switchTab(el, tab) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  ['products','options','notes'].forEach(t => {
    document.getElementById('tab-' + t).style.display = (t === tab) ? 'block' : 'none';
  });
}

function recalc() {
  const qCore  = parseInt(document.getElementById('qty-core').value) || 0;
  const caOn   = document.getElementById('chk-ca').checked;
  const qCA    = caOn ? (parseInt(document.getElementById('qty-ca').value) || 0) : 0;
  const disc   = Math.min(40, Math.max(0, parseFloat(document.getElementById('discount-pct').value) || 0));
  const onb    = document.getElementById('toggle-onboarding').checked ? ONBOARD : 0;
  const pd     = document.getElementById('toggle-pd').checked ? PD : 0;

  const coreAmt  = qCore * CORE_UNIT;
  const caAmt    = qCA   * CA_UNIT;
  const subtotal = coreAmt + caAmt + onb + pd;
  const discAmt  = subtotal * (disc / 100);
  const total    = subtotal - discAmt;

  // Update product row prices
  document.getElementById('price-core').textContent = fmt(coreAmt);
  document.getElementById('price-ca').textContent   = fmt(caAmt);

  // Summary
  document.getElementById('sum-core').textContent     = fmt(coreAmt);
  document.getElementById('sum-ca').textContent       = fmt(caAmt);
  document.getElementById('sum-subtotal').textContent = fmt(subtotal);
  document.getElementById('sum-total').textContent    = fmt(total);
  document.getElementById('sum-ca-row').style.display = caOn ? '' : 'none';
  document.getElementById('sum-onboard-row').style.display = onb ? '' : 'none';
  document.getElementById('sum-pd-row').style.display      = pd  ? '' : 'none';

  if (disc > 0) {
    document.getElementById('sum-disc-row').style.display = '';
    document.getElementById('sum-discount').textContent   = '-' + fmt(discAmt);
  } else {
    document.getElementById('sum-disc-row').style.display = 'none';
  }

  // Discount description
  const descEl = document.getElementById('discount-desc');
  if (disc === 0)       descEl.textContent = 'No discount applied';
  else if (disc <= 10)  descEl.textContent = disc + '% ‚Äî auto-approved';
  else if (disc <= 20)  descEl.textContent = disc + '% ‚Äî manager approval required';
  else                  descEl.textContent = disc + '% ‚Äî VP approval required';

  // Approval banner
  const banner = document.getElementById('approval-banner');
  const chip   = document.getElementById('approval-status-chip');
  const chipTxt = document.getElementById('approval-status-text');
  if (disc === 0) {
    banner.className = 'approval-banner hidden';
    chip.className = 'status-chip chip-approved';
    chipTxt.textContent = 'Auto-Approved (0% discount)';
  } else if (disc <= 10) {
    banner.className = 'approval-banner ok';
    document.getElementById('approval-icon').textContent = '‚úÖ';
    document.getElementById('approval-title').textContent = 'Auto-Approved';
    document.getElementById('approval-desc').textContent = disc + '% discount is within auto-approval threshold (‚â§10%). No action needed.';
    chip.className = 'status-chip chip-approved';
    chipTxt.textContent = 'Auto-Approved (' + disc + '%)';
  } else if (disc <= 20) {
    banner.className = 'approval-banner warn';
    document.getElementById('approval-icon').textContent = '‚ö†Ô∏è';
    document.getElementById('approval-title').textContent = 'Manager Approval Required';
    document.getElementById('approval-desc').textContent = disc + '% discount requires your manager\'s approval. Quote will be routed automatically on submission.';
    chip.className = 'status-chip chip-pending';
    chipTxt.textContent = 'Pending Manager Approval';
  } else {
    banner.className = 'approval-banner block';
    document.getElementById('approval-icon').textContent = 'üö´';
    document.getElementById('approval-title').textContent = 'VP Approval Required';
    document.getElementById('approval-desc').textContent = disc + '% discount requires VP-level approval. Submission will trigger an approval workflow.';
    chip.className = 'status-chip chip-pending';
    chipTxt.textContent = 'Pending VP Approval';
  }

  // ARR Attribution
  document.getElementById('attr-core').textContent = '$' + coreAmt.toLocaleString();
  document.getElementById('attr-ca').textContent   = '$' + caAmt.toLocaleString();
  const totalARR = coreAmt + caAmt;
  const corePct  = totalARR ? Math.round((coreAmt / totalARR) * 100) : 100;
  const caPct    = totalARR ? Math.round((caAmt   / totalARR) * 100) : 0;
  document.getElementById('bar-core').style.width = corePct + '%';
  document.getElementById('bar-ca').style.width   = caPct   + '%';
  document.getElementById('attach-pct').textContent = caPct + '%';

  // Opp type
  let oppType, motion, pipelineTag;
  if (caOn && qCA > 0) {
    oppType = 'Renewal + CA Add-On'; motion = 'Renewal + Expansion'; pipelineTag = 'Renewal + CA Add-On';
  } else {
    oppType = 'Core Renewal'; motion = 'Renewal'; pipelineTag = 'Core Renewal Only';
  }
  document.getElementById('opp-type-field').value  = oppType;
  document.getElementById('attr-opp-type').textContent = oppType;
  document.getElementById('pipeline-motion').textContent = motion;
  document.getElementById('pipeline-tag').textContent    = pipelineTag;

  // CA chip
  document.getElementById('chip-ca').style.display = caOn ? '' : 'none';

  // Dependency check
  updateDependencyCheck(caOn);
}

function generateQuote() {
  // Populate quote doc
  const qCore   = parseInt(document.getElementById('qty-core').value) || 0;
  const caOn    = document.getElementById('chk-ca').checked;
  const qCA     = caOn ? (parseInt(document.getElementById('qty-ca').value) || 0) : 0;
  const disc    = parseFloat(document.getElementById('discount-pct').value) || 0;
  const onb     = document.getElementById('toggle-onboarding').checked ? ONBOARD : 0;
  const pd      = document.getElementById('toggle-pd').checked ? PD : 0;
  const coreAmt = qCore * CORE_UNIT;
  const caAmt   = qCA   * CA_UNIT;
  const subtotal = coreAmt + caAmt + onb + pd;
  const discAmt  = subtotal * (disc / 100);
  const total    = subtotal - discAmt;
  const term     = document.getElementById('contract-term').value;

  const now = new Date();
  const qNum = 'Q-' + now.getFullYear() + '-' + String(Math.floor(Math.random()*9000+1000));
  document.getElementById('quote-num').textContent  = qNum;
  document.getElementById('success-quote-num').textContent = qNum;
  document.getElementById('quote-date').textContent = 'Generated: ' + now.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
  document.getElementById('qo-account').textContent = document.getElementById('account-name').value;
  document.getElementById('qo-valid').textContent   = document.getElementById('close-date').value;
  document.getElementById('qo-term').textContent    = term + ' Months';
  document.getElementById('qo-subtotal').textContent = fmt(subtotal);
  document.getElementById('qo-total').textContent   = fmt(total);

  if (disc > 0) {
    document.getElementById('qo-discount-row').style.display = '';
    document.getElementById('qo-discount-amt').textContent = '-' + fmt(discAmt);
  }

  // Line items
  const tbody = document.getElementById('quote-line-items');
  tbody.innerHTML = '';
  let idx = 1;
  const rows = [
    { name: 'Wayground Core', sub: 'District License ¬∑ Renewal', qty: qCore, unit: CORE_UNIT, amt: coreAmt },
  ];
  if (caOn && qCA > 0) rows.push({ name: 'Common Assessment (CA)', sub: 'Add-On ¬∑ Standards-aligned assessment', qty: qCA, unit: CA_UNIT, amt: caAmt });
  if (onb) rows.push({ name: 'Onboarding Package', sub: 'CA implementation & CSM', qty: 1, unit: ONBOARD, amt: ONBOARD });
  if (pd)  rows.push({ name: 'Professional Development', sub: '5 PD sessions', qty: 1, unit: PD, amt: PD });

  rows.forEach(r => {
    const discDisplay = disc > 0 ? disc + '%' : '‚Äî';
    tbody.innerHTML += `<tr>
      <td style="color:var(--grayLt);">${idx++}</td>
      <td><strong>${r.name}</strong><div style="font-size:11.5px;color:var(--grayLt)">${r.sub}</div></td>
      <td class="price-cell">${r.qty.toLocaleString()}</td>
      <td class="price-cell">${fmt(r.unit)}</td>
      <td style="color:var(--green);font-weight:500;">${discDisplay}</td>
      <td class="price-cell price-total">${fmt(r.amt)}</td>
    </tr>`;
  });

  // Show quote output
  document.getElementById('quote-output').classList.add('show');
  document.getElementById('quote-output').scrollIntoView({ behavior: 'smooth', block: 'start' });

  // Advance stages
  document.querySelectorAll('.stage').forEach((s, i) => {
    if (i < 4) { s.classList.remove('active'); s.classList.add('done'); }
    if (i === 4) { s.classList.add('active'); }
  });
}

function submitQuote() {
  document.getElementById('success-overlay').classList.add('show');
}

function closeQuote() {
  document.getElementById('quote-output').classList.remove('show');
}

function closeSuccess() {
  document.getElementById('success-overlay').classList.remove('show');
}

function saveDraft() {
  const btn = document.querySelector('.btn-secondary.btn-full');
  btn.textContent = '‚úÖ Draft Saved';
  btn.style.color = 'var(--green)';
  setTimeout(() => { btn.textContent = 'üíæ Save Draft'; btn.style.color = ''; }, 2000);
}

// Init
recalc();
</script>
</body>
</html>
